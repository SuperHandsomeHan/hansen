<meta charset="UTF-8">
<div class="row">
    <div class="col-md-12 grid-margin">
        <div class="d-flex justify-content-between flex-wrap">
            <div class="d-flex align-items-end flex-wrap">
                <div class="mr-md-3 mr-xl-5">
                    <h2>欢迎回来, <span id="uname"></span>！！！</h2>
                    <p class="mb-md-0">下面是你的个人数据.</p>
                </div>
                <div class="d-flex">
                    <i class="mdi mdi-home text-muted hover-cursor"></i>
                    <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;登录&nbsp;/&nbsp;</p>
                    <p class="text-primary mb-0 hover-cursor">个人中心</p>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body dashboard-tabs p-0">
                <ul class="nav nav-tabs px-4" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="overview-tab" data-toggle="tab" href="#overview" role="tab" aria-controls="overview" aria-selected="true">统计</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="sales-tab" data-toggle="tab" href="#sales" role="tab" aria-controls="sales" aria-selected="false">其他</a>
                    </li>
                </ul>
                <div class="tab-content py-0 px-0">
                    <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                        <div class="d-flex flex-wrap justify-content-xl-between">
                            <div class="d-none d-xl-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                                <i class="mdi mdi-calendar-heart icon-lg mr-3 text-primary"></i>
                                <div class="d-flex flex-column justify-content-around">
                                    <small class="mb-1 text-muted">工龄</small>
                                    <h5 class="mb-0 d-inline-block"><span>4</span> 年</h5>
                                </div>
                            </div>
                            <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                                <i class="mdi mdi-database-minus mr-3 icon-lg text-warning"></i>
                                <div class="d-flex flex-column justify-content-around">
                                    <small class="mb-1 text-muted">本月工资</small>
                                    <h5 class="mr-2 mb-0">￥<span>577545</span></h5>
                                </div>
                            </div>
                            <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                                <i class="mdi mdi-database-minus mr-3 icon-lg text-warning"></i>
                                <div class="d-flex flex-column justify-content-around">
                                    <small class="mb-1 text-muted">底薪</small>
                                    <h5 class="mr-2 mb-0">￥<span>5775</span></h5>
                                </div>
                            </div>
                            <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                                <i class="mdi mdi-clipboard-outline mr-3 icon-lg text-info"></i>
                                <div class="d-flex flex-column justify-content-around">
                                    <small class="mb-1 text-muted">本月订单数</small>
                                    <h5 class="mr-2 mb-0">9833550</h5>
                                </div>
                            </div>
                            <div class="d-flex py-3 border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                                <i class="mdi mdi-clipboard-text mr-3 icon-lg text-success"></i>
                                <div class="d-flex flex-column justify-content-around">
                                    <small class="mb-1 text-muted">本月出勤数</small>
                                    <h5 class="mr-2 mb-0">200</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="sales" role="tabpanel" aria-labelledby="sales-tab">
                        <div class="d-flex flex-wrap justify-content-xl-between">
                            <div class="d-none d-xl-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                                <i class="mdi mdi-database-minus icon-lg mr-3 text-warning"></i>
                                <div class="d-flex flex-column justify-content-around">
                                    <small class="mb-1 text-muted">今年年终奖</small>
                                    <h5 class="mb-0 d-inline-block">￥<span>2000</span></h5>
                                </div>
                            </div>
                            <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                                <i class="mdi mdi-bookmark-remove mr-3 icon-lg text-danger"></i>
                                <div class="d-flex flex-column justify-content-around">
                                    <small class="mb-1 text-muted">今年缺勤数</small>
                                    <h5 class="mr-2 mb-0">225</h5>
                                </div>
                            </div>
                            <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                                <i class="mdi mdi-bookmark-remove mr-3 icon-lg text-danger"></i>
                                <div class="d-flex flex-column justify-content-around">
                                    <small class="mb-1 text-muted">今年请假数</small>
                                    <h5 class="mr-2 mb-0">50</h5>
                                </div>
                            </div>
                            <div class="d-flex py-3 border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                                <i class="mdi mdi-flag mr-3 icon-lg text-info"></i>
                                <div class="d-flex flex-column justify-content-around">
                                    <small class="mb-1 text-muted">职位</small>
                                    <h5 class="mr-2 mb-0">老板</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-7 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">正在进行中的订单。。。</h4>
                <div style="text-align: right; margin-bottom: 20px;">
                    <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#add-modal">
                        录入
                    </button>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>客户名称</th>
                            <th>手机号</th>
                            <th>备注</th>
                            <th>维修人员</th>
                            <th>订单金额</th>
                            <th>接单时间</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="tab1"></tbody>
                    </table>
                    <div id="comment_page" align="right" style="padding:10px 0px"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-5 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <p class="card-title">年收入</p>
                <h1>$ 28835</h1>
                <h4>今年的个人总收入，除去缺勤、请假扣除的金额</h4>
                <p class="text-muted">上一年总收入个人￥<span>12322</span><br/>与今年的这一天有明显的上升</p>
                <div id="total-sales-chart-legend">
                    <img src="img/LOGO2.png" width="550" style="margin-top: 50px;">
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 修改订单状态模态框 -->
<div class="modal fade bs-example-modal-sm" id="updateStatu" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">修改订单状态</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <form id="from_update">
                    <input type="hidden" name="rid" id="update_rid">
                    <select class="form-control" name="status" id="update_type">
                        <option value="进行中" selected>
                            进行中
                        </option>
                        <option value="排队中">
                            排队中
                        </option>
                        <option value="检查中">
                            检查中
                        </option>
                        <option value="已完成">
                            已完成
                        </option>
                        <option value="已结束">
                            已结束
                        </option>
                    </select>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="finish_update_btn">修改</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-example-modal-sm" id="add-modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">订单录入</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <form class="forms-samplec" id="from_add">
                    <div class="form-group">
                        <label>备注</label>
                        <input type="text" class="form-control" placeholder="备注" name="remarks" id="add_remark">
                    </div>
                    <div class="form-group">
                        <label>维修人员</label>
                        <select id="add_uid" name="uid">
                        </select>
                    </div>
                    <div class="form-group">
                        <label>客户名称</label>
                        <input type="text" class="form-control" placeholder="客户名称" name="carUserName" id="add_carUserName">
                    </div>
                    <div class="form-group">
                        <label>客户电话</label>
                        <input type="text" class="form-control" placeholder="客户电话" name="carUserTel" id="add_tel">
                    </div>
                    <div class="form-group">
                        <label>维修价格</label>
                        <input type="text" class="form-control" placeholder="维修价格" name="price" id="add_price">
                    </div>
                    <div class="form-group">
                        <label>选中商品</label>
                        <select id="add_goods" name="gid">
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="finish_add_btn">添加</button>
            </div>
        </div>
    </div>
</div>
<script src="js/jquery.pagination.js"></script>
<script src="js/bootstrap.min.js"></script>
<script>
    var rid;
    var className;
    $(function () {
        init();
        $('#finish_update_btn').on('click',function () {
            $.ajax({
                url : 'update_repairInfo',
                method : 'post',
                data : $('#from_update').serialize() ,
                success : function (result) {
                    alert(result.message);
                    if(result.code == 200){
                        init();
                    }
                }
            });
        });
        $('#finish_add_btn').on('click',function () {
            $.ajax({
                url : 'add_repairInfo',
                method : 'post',
                data : $('#from_add').serialize(),
                success : function (result) {
                    alert(result.message);
                    if(result.code == 200){
                        init();
                        clearAdd();
                    }
                }
            });
        });
    });
    function getClassName(name) {
        if(name == "进行中"){
            className = ' class="badge badge-warning" style="color: white;"';
        }else if(name == "排队中"){
            className = ' class="badge badge-danger"';
        }else if(name == "检查中"){
            className = ' class="badge badge-info"';
        }else if(name == "已完成"){
            className = ' class="badge badge-success"';
        }else if(name == "已结束"){
            className = ' class="badge badge-dark"';
        }
    }
    function init() {
        clearAdd();
        $.ajax({
            url : 'list_repairInfo',
            method : 'get',
            data: 'pageNum=0&pageSize=5',
            success : function (result) {
                addTable(result.data.list);
                $('#comment_page').pagination(result.data.total, { //第一个参数指定共多少条记录
                    items_per_page: result.data.pageSize, // 每页显示多少条记录
                    next_text: '下一页', //下一页按钮图标
                    prev_text: '上一页', //上一页按钮图标
                    num_display_entries: 5,//主体页数
                    num_edge_entries: 2, //边缘页数
                    callback: function (pageNum) {//定义一个回调函数，用于每次点击页码发起分页查询请求
                        pageNum = ++pageNum;
                        $.ajax({
                            url: 'list_repairInfo',
                            method: 'get',
                            data: 'pageNum=' + pageNum + '&pageSize=' + result.data.pageSize,
                            success: function (vo) {
                                if(vo.code == 200){
                                    addTable(vo.data.list);
                                }else {
                                    alert("数据库连接失败");
                                }
                            }
                        });
                    }
                });
            }
        });
    }

    function clearUpdate(){
        $('#update_type').val("进行中");
    }
    function loadUpdate(data) {
        $('#update_type').val(data.status);
        $('#update_rid').val(data.rid);
    }
    function clearAdd(){
        $('#add_remark').val("");
        $('#add_tel').val("");
        $('#add_price').val("");
        $('#add_carUserName').val("");
        $.ajax({
            url : 'get_all_user',
            method : 'get',
            success : function (result) {
                $('#add_uid').empty();
                $.each(result.data, function (index,obj) {
                    $('#add_uid').append('<option value="' + obj.uid + '">' + obj.userName + '</option>');
                });
            }
        });
        $.ajax({
            url : 'get_all_goods',
            method : 'get',
            success : function (result) {
                $('#add_goods').empty();
                $.each(result.data, function (index,obj) {
                    $('#add_goods').append('<option value="' + obj.gid + '">' + obj.gname + '</option>');
                });
            }
        });
    }

    function addTable(data) {
        $('#tab1').empty();
        $.each(data, function (index,obj) {
            getClassName(obj.status);
            $('#tab1').append(
                '<tr>' +
                '<td>' + obj.carUserName + '</td>' +
                '<td>' + obj.carUserTel + '</td>' +
                '<td>' + obj.remarks + '</td>' +
                '<td>' + obj.user.userName + '</td>' +
                '<td>￥' + obj.price + '</td>' +
                '<td>' + obj.rtime + '</td>' +
                '<td><label' + className + '>' + obj.status + '</label></td>' +
                '<td>' +
                '<button type="button" class="btn btn-primary btn-sm update-btn" data-toggle="modal" data-target="#updateStatu">' +
                '修改' +
                '</button>' +
                '<input type="hidden" value="' + obj.rid + '">' +
                '</td>' +
                '</tr>'
            );
            $('.update-btn').on('click',function (){
                rid = $(this).next().val();
                clearUpdate();
                $.ajax({
                    url : 'get_repairInfo',
                    method : 'get',
                    data : 'rid=' + rid,
                    success : function (result) {
                        loadUpdate(result.data);
                    }
                });
            });
        });
    }
</script>